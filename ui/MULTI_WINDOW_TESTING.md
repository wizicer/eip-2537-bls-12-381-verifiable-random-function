# 多窗口交易测试指南

## 概述

现在你可以在多个浏览器窗口中进行交易，所有交易都会实时显示在交易监控面板中。

## 测试账户

以下是20个测试账户，使用不同的账户进行多窗口测试：

### 前5个账户（推荐使用）：
```
账户1: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
私钥:   0xac0974bec39a17e36ba4a6b4d238ff944bacb478cbed5efcae784d7bf4f2ff80

账户2: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
私钥:   0x59c6995e998f97a5a0044966f0945389dc9e86dae88c7a8412f4603b6b78690d

账户3: 0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC
私钥:   0x5de4111afa1a4b94908f83103eb1f1706367c2e68ca870fc3fb9a804cdab365a

账户4: 0x90F79bf6EB2c4f870365E785982E1f101E93b906
私钥:   0x7c852118294e51e653712a81e05800f419141751be58f605c371e15141b007a6

账户5: 0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65
私钥:   0x47e179ec197488593b187f80a00eb0da91f1b9d0b13f8733639f19c30a34926a
```

每个账户都有10000 ETH的测试资金。

## 测试步骤

### 1. 准备多个窗口
1. 打开浏览器，访问 http://localhost:5173/
2. 打开新的浏览器窗口或标签页（建议2-3个窗口）
3. 每个窗口使用不同的MetaMask账户

### 2. 配置MetaMask账户
在每个窗口中：
1. 点击MetaMask扩展
2. 切换到不同账户或导入新账户
3. 确保网络设置为"Hardhat Localhost"

### 3. 进行交易测试

#### 场景1：基本买卖测试
- 窗口A：使用账户1，提交买单（Buy 1 ETH at $2100）
- 窗口B：使用账户2，提交卖单（Sell 1 ETH at $2100）
- 观察交易监控面板中的实时更新

#### 场景2：价格差异测试
- 窗口A：买单 $2100
- 窗口B：卖单 $2105
- 窗口C：买单 $2095
- 观察订单簿和交易匹配

#### 场景3：大额交易测试
- 窗口A：大额买单（Buy 10 ETH）
- 窗口B：小额卖单（Sell 1 ETH）
- 重复测试以验证部分匹配

### 4. 验证合约功能

#### 交易验证
在Hardhat节点控制台中查看交易：
```bash
# 查看所有交易
grep "Transaction" hardhat_output.log

# 查看区块信息
grep "Mined" hardhat_output.log
```

#### 合约状态查询
```javascript
// 在浏览器控制台中
const contract = await darkPoolService.getContract();
const orderCount = await contract.getOrderCount();
console.log('Total orders:', orderCount.toString());
```

## 实时监控功能

### TransactionMonitor组件特性：
- ✅ 实时显示所有交易
- ✅ 区分买单/卖单（绿色/红色）
- ✅ 显示交易时间戳
- ✅ 显示交易金额和价格
- ✅ 自动更新订单总数
- ✅ 显示交易发送者地址

### 监控面板信息：
1. **Total Orders** - 合约中的总订单数
2. **交易列表** - 最近10笔交易
3. **实时状态** - 绿点表示正在监听

## 验证要点

### 1. 交易确认
- 每笔交易都应生成唯一的交易哈希
- MetaMask应显示交易确认
- 交易应出现在区块中

### 2. 数据一致性
- 所有窗口应显示相同的订单总数
- 交易监控应实时更新
- 价格和数量应正确记录

### 3. 隐私保护
- 价格默认隐藏
- 需要手动点击显示
- 地址部分显示（前6后4位）

## 常见问题

### Q: 交易没有出现在监控中？
A: 确保：
- 已连接钱包
- 在正确的网络（31337）
- 合约已正确初始化

### Q: 交易失败？
A: 检查：
- 账户是否有足够ETH
- 合约地址是否正确
- Gas设置是否合理

### Q: 看不到其他窗口的交易？
A: 确认：
- 所有窗口连接到同一个本地网络
- 使用的是同一个合约地址
- 页面已刷新

## 高级测试

### 1. 并发交易测试
同时在不同窗口提交多笔交易，验证：
- 交易顺序
- 没有双重花费
- 正确的匹配逻辑

### 2. 网络切换测试
在交易过程中切换网络，验证：
- 错误处理
- 状态恢复
- 数据完整性

### 3. 刷新测试
刷新页面后验证：
- 状态正确恢复
- 历史交易可查
- 订单计数准确

现在你可以开始多窗口交易测试了！所有交易都是真实的区块链交易。